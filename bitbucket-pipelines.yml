pipelines:
  default:
    - step:
        name: Build and test
        caches:
          - maven
        image: maven:3.3.9
        services:
          - docker
        script:
          - cd ./FunctionSource
          - mvn -B verify    # -B batch mode makes Maven less verbose
    - step:
        name: Deploy to AWS
        image: atlassian/pipelines-awscli
        script:
            #- export AWS_ACCESS_KEY_ID=$CODERS_AWS_ACCESS_KEY_ID
            #- export AWS_SECRET_ACCESS_KEY=$CODERS_AWS_SECRET_ACCESS_KEY
            - codebucket="cf-templates-u6grlzjqw4qg-ap-southeast-2"
            - sam build -b ./build -t labstats.yaml
            #- sam package --template-file build/template.yaml --output-template-file packaged.yaml --s3-bucket $codebucket
            #- sam deploy --template-file packaged.yaml --parameter-overrides Lifecycle=Development Environment=D Application=lbst --capabilities CAPABILITY_IAM --stack-name lbstSyncFunc
